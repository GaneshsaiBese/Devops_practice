#FROM python:3.11-slim
#ENV DEBIAN_FRONTEND=noninteractive \
  # STREAMLIT_SERVER_ADDRESS=0.0.0.0 \
   #STREAMLIT_SERVER_PORT=8501 \
   #PYTHONUNBUFFERED=1
#WORKDIR /app
#COPY requirements.txt .
#RUN pip install --upgrade pip setuptools wheel && \
#   pip install --no-cache-dir -r requirements.txt
#COPY streamlit_app.py .
#EXPOSE 8501
#CMD ["streamlit", "run", "streamlit_app.py", "--server.port=8501", "--server.address=0.0.0.0"]

# Build stage using Alpine (with corrected casing)
FROM python:3.11-alpine as builder

WORKDIR /app

# Install build dependencies
RUN apk update && apk add --no-cache \
    gcc \
    musl-dev \
    libffi-dev \
    && python -m ensurepip --upgrade \
    && pip install --no-cache-dir --upgrade pip setuptools wheel

# Copy the requirements file and install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the application files
COPY . .
# Ensure streamlit is installed correctly
RUN pip show streamlit

# Final stage using python:3.11-slim
FROM python:3.11-slim

WORKDIR /app

# Copy installed dependencies and app files from the builder stage
COPY --from=builder /app /app
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages
ENV PATH="/usr/local/bin:$PATH"
RUN pip show streamlit
RUN which streamlit
# Expose the port for Streamlit
EXPOSE 8501

# Command to run Streamlit
CMD ["streamlit", "run", "streamlit_app.py", "--server.port=8501", "--server.address=0.0.0.0"]

